{% extends 'base.html' %}
{% load static %}

{% block title %}Card-Jitsu de Vinos 🍷🎴{% endblock %}

{% block content %}
<div class="container text-center my-5">
    <h2>🍷 Card-Jitsu de Vinos 🎴</h2>
    <p>Selecciona una carta y enfréntate al oponente en una categoría aleatoria.</p>

    <!-- Cartas del Jugador -->
    <div class="row justify-content-center my-4" id="player-cards">
        <!-- Se generarán dinámicamente -->
    </div>

    <button id="fight-btn" class="btn btn-primary mt-3" disabled>Iniciar Ronda</button>

    <div class="row justify-content-center my-4" id="battle-result">
        <!-- Resultado de la batalla -->
    </div>
</div>

<script>
    const wines = [
        { name: "Vino Tinto", cuerpo: 80, aroma: 70, sabor: 75, img: "{% static 'images/vino.webp' %}" },
        { name: "Vino Blanco", cuerpo: 60, aroma: 80, sabor: 70, img: "{% static 'images/vino.webp' %}" },
        { name: "Vino Rosado", cuerpo: 50, aroma: 60, sabor: 65, img: "{% static 'images/vino.webp' %}" }
    ];

    let selectedCard = null;
    const categories = ["cuerpo", "aroma", "sabor"];

    function renderCards() {
        const playerCardsContainer = document.getElementById("player-cards");
        playerCardsContainer.innerHTML = "";

        wines.forEach((wine, index) => {
            const card = document.createElement("div");
            card.className = "col-md-3 card shadow p-2 mx-2 wine-card";
            card.innerHTML = `
                <img src="${wine.img}" class="card-img-top" alt="${wine.name}" style="height: 150px; object-fit: cover;">
                <div class="card-body">
                    <h5 class="card-title">${wine.name}</h5>
                    <p>⚔️ Cuerpo: ${wine.cuerpo}</p>
                    <p>🌿 Aroma: ${wine.aroma}</p>
                    <p>🍷 Sabor: ${wine.sabor}</p>
                </div>
            `;
            card.onclick = () => selectCard(index);
            playerCardsContainer.appendChild(card);
        });
    }

    function selectCard(index) {
        selectedCard = wines[index];
        document.querySelectorAll(".wine-card").forEach(card => card.classList.remove("selected"));
        document.querySelectorAll(".wine-card")[index].classList.add("selected");
        document.getElementById("fight-btn").disabled = false;
    }

    function fight() {
        if (!selectedCard) return;

        const opponentWine = wines[Math.floor(Math.random() * wines.length)];
        const selectedCategory = categories[Math.floor(Math.random() * categories.length)];
        
        const playerValue = selectedCard[selectedCategory];
        const opponentValue = opponentWine[selectedCategory];
        
        let resultMessage = `
            <div class='col-md-5 card p-3'>
                <h4>Tu Carta: ${selectedCard.name}</h4>
                <p>${selectedCategory.toUpperCase()}: ${playerValue}</p>
            </div>
            <div class='col-md-5 card p-3'>
                <h4>Oponente: ${opponentWine.name}</h4>
                <p>${selectedCategory.toUpperCase()}: ${opponentValue}</p>
            </div>
        `;
        
        if (playerValue > opponentValue) {
            resultMessage += "<h3 class='text-success mt-3'>🎉 ¡Ganaste esta ronda! 🎉</h3>";
        } else if (playerValue < opponentValue) {
            resultMessage += "<h3 class='text-danger mt-3'>💀 Perdiste esta ronda 💀</h3>";
        } else {
            resultMessage += "<h3 class='text-warning mt-3'>🤝 Empate 🤝</h3>";
        }

        document.getElementById("battle-result").innerHTML = resultMessage;
    }

    document.getElementById("fight-btn").addEventListener("click", fight);
    renderCards();
</script>

<style>
    .wine-card {
        cursor: pointer;
        border: 2px solid transparent;
        transition: 0.3s;
    }
    .wine-card:hover, .wine-card.selected {
        border-color: #007bff;
        box-shadow: 0 0 15px rgba(0, 123, 255, 0.4);
    }
</style>

{% endblock %}
